# CI/CD ä¼˜åŒ–å®æ–½æ€»ç»“

## ğŸ“Š å®¡è®¡è¿‡ç¨‹

### å®¡è®¡æ¥æº
1. **GPT-5 åˆæ­¥åˆ†æ**ï¼šè¯†åˆ«äº† 7 ä¸ªæ½œåœ¨é—®é¢˜
2. **Augment äº¤å‰éªŒè¯**ï¼šå¯¹ GPT-5 çš„åˆ†æè¿›è¡Œäº†é€é¡¹éªŒè¯
3. **GPT-5 æœ€ç»ˆåé¦ˆ**ï¼šæä¾›äº†è¯¦ç»†çš„åˆ†å±‚ç¼“å­˜ç­–ç•¥
4. **æœ€ç»ˆå®æ–½**ï¼šåŸºäºåŒæ–¹å…±è¯†çš„ä¼˜åŒ–æ–¹æ¡ˆ

### å®¡è®¡ç»“è®ºå¯¹æ¯”

| é¡¹ç›® | GPT-5 åˆæ­¥ | Augment éªŒè¯ | GPT-5 æœ€ç»ˆ | æœ€ç»ˆå†³ç­– |
|------|-----------|------------|-----------|---------|
| å¹¶å‘æ§åˆ¶ | âœ… å‡†ç¡® | âœ… åŒæ„ | âœ… ç¡®è®¤ | **å·²å®æ–½** |
| E2E é‡å¤æ„å»º | âœ… å‡†ç¡® | âœ… åŒæ„ | âœ… ç¡®è®¤ | **å·²å®æ–½** |
| ç¼“å­˜ä¸ä¸€è‡´ | âœ… å‡†ç¡® | âœ… åŒæ„ | âœ… ç¡®è®¤ | **å·²å®æ–½** |
| ç¼“å­˜ key ç­–ç•¥ | âš ï¸ éƒ¨åˆ†å‡†ç¡® | âš ï¸ éœ€ç»†åŒ– | âœ… åˆ†å±‚ç­–ç•¥ | **å·²å®æ–½** |
| è¦†ç›–ç‡é˜ˆå€¼ | âŒ è¯¯åˆ¤ | âœ… çº æ­£ | âœ… åŒæ„ | **æ— éœ€æ”¹åŠ¨** |
| LHCI token | âŒ è¯¯å¯¼ | âœ… çº æ­£ | âœ… åŒæ„ | **æ— éœ€æ”¹åŠ¨** |
| Playwright è¶…æ—¶ | âš ï¸ æ¿€è¿› | âš ï¸ æ¿€è¿› | âœ… ä¿å®ˆ | **ä¿æŒ 180s** |

---

## âœ… å·²å®æ–½çš„æ”¹åŠ¨

### 1. å¹¶å‘æ§åˆ¶ä¿®å¤
```yaml
# æ–‡ä»¶ï¼š.github/workflows/ci.yml
# è¡Œå·ï¼š10-12

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}  # ç§»é™¤äº† github.sha
  cancel-in-progress: true
```

### 2. E2E é‡å¤æ„å»ºç§»é™¤
```yaml
# æ–‡ä»¶ï¼š.github/workflows/ci.yml
# åˆ é™¤ï¼še2e-tests ä½œä¸šä¸­çš„ "æ„å»ºé¡¹ç›®" æ­¥éª¤
# åŸå› ï¼šPlaywright webServer å·²ç»ä¼šæ‰§è¡Œ pnpm build && pnpm start
```

### 3. åˆ†å±‚ç¼“å­˜ç­–ç•¥

#### 3.1 basic-checks ä½œä¸š
- âœ… ä¼˜åŒ– pnpm store ç¼“å­˜ï¼ˆç§»é™¤ node_modulesï¼‰
- âœ… ä½¿ç”¨ç¨³å®šçš„ lockfile-only key

#### 3.2 tests ä½œä¸š
- âœ… æ·»åŠ  pnpm store ç¼“å­˜
- âœ… æ·»åŠ  Vitest ç¼“å­˜

#### 3.3 e2e-tests ä½œä¸š
- âœ… æ·»åŠ  pnpm store ç¼“å­˜
- âœ… æ·»åŠ  Next.js æ„å»ºç¼“å­˜

#### 3.4 performance ä½œä¸š
- âœ… æ·»åŠ  pnpm store ç¼“å­˜
- âœ… æ·»åŠ  Next.js æ„å»ºç¼“å­˜

#### 3.5 security ä½œä¸š
- âœ… æ·»åŠ  pnpm store ç¼“å­˜

#### 3.6 translation-quality ä½œä¸š
- âœ… æ·»åŠ  pnpm store ç¼“å­˜

#### 3.7 architecture ä½œä¸š
- âœ… æ·»åŠ  pnpm store ç¼“å­˜

---

## ğŸ¯ ç¼“å­˜ç­–ç•¥è¯¦è§£

### ä¾èµ–ç¼“å­˜ï¼ˆæ‰€æœ‰ä½œä¸šï¼‰
```yaml
- name: Cache pnpm store
  uses: actions/cache@v4
  with:
    path: ~/.pnpm-store
    key: ${{ runner.os }}-node20-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}
    restore-keys: |
      ${{ runner.os }}-node20-pnpm-
```

**ç‰¹ç‚¹**ï¼š
- åªç¼“å­˜ pnpm storeï¼ˆä¸ç¼“å­˜ node_modulesï¼‰
- åªç”¨ lockfile hashï¼ˆæœ€å¤§åŒ–å‘½ä¸­ç‡ï¼‰
- è·¨ä½œä¸šå…±äº«ï¼ˆæ‰€æœ‰ä½œä¸šä½¿ç”¨ç›¸åŒçš„ keyï¼‰

### æ„å»ºç¼“å­˜ï¼ˆe2e-tests, performanceï¼‰
```yaml
- name: Cache Next.js build
  uses: actions/cache@v4
  with:
    path: .next/cache
    key: ${{ runner.os }}-next-cache-${{ hashFiles('**/pnpm-lock.yaml') }}-${{ hashFiles('next.config.*', 'tsconfig*.json', 'tailwind.config.js', 'postcss.config.*', 'src/**/*.{ts,tsx,js,jsx,css,scss,mdx}') }}
    restore-keys: |
      ${{ runner.os }}-next-cache-${{ hashFiles('**/pnpm-lock.yaml') }}-
```

**ç‰¹ç‚¹**ï¼š
- ç»‘å®šæºç å’Œé…ç½®æ–‡ä»¶
- åˆç†å¤±æ•ˆï¼ˆåªåœ¨æ„å»ºè¾“å…¥å˜åŒ–æ—¶ï¼‰
- è·¨æäº¤å¤ç”¨ï¼ˆä¸ä½¿ç”¨ github.shaï¼‰

### æµ‹è¯•ç¼“å­˜ï¼ˆtestsï¼‰
```yaml
- name: Cache Vitest
  uses: actions/cache@v4
  with:
    path: .vitest/cache
    key: ${{ runner.os }}-vitest-cache-${{ hashFiles('**/pnpm-lock.yaml') }}-${{ hashFiles('vitest.config.*', 'tsconfig*.json', 'src/**/*.{ts,tsx,js,jsx}', 'tests/**/*.{ts,tsx,js,jsx}') }}
    restore-keys: |
      ${{ runner.os }}-vitest-cache-${{ hashFiles('**/pnpm-lock.yaml') }}-
```

**ç‰¹ç‚¹**ï¼š
- ç»‘å®šæµ‹è¯•é…ç½®å’Œæºç 
- æ˜¾è‘—å‡å°‘ç¼–è¯‘æ—¶é—´

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### æ—¶é—´èŠ‚çœ
| ä¼˜åŒ–é¡¹ | èŠ‚çœæ—¶é—´ | é¢‘ç‡ |
|--------|---------|------|
| å¹¶å‘æ§åˆ¶ | 5-10 åˆ†é’Ÿ | æ¯æ¬¡æ–°æ¨é€ |
| E2E å»é‡ | 3-5 åˆ†é’Ÿ | æ¯æ¬¡ E2E è¿è¡Œ |
| ç¼“å­˜å¤ç”¨ | 1-2 åˆ†é’Ÿ/ä½œä¸š | æ¯æ¬¡ CI è¿è¡Œ |
| **æ€»è®¡** | **8-15 åˆ†é’Ÿ** | **æ¯æ¬¡ CI** |

### æ•ˆç‡æå‡
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼šé¢„è®¡ä» 0% æå‡åˆ° 70-90%
- **ä¾èµ–å®‰è£…**ï¼šä» 2-3 åˆ†é’Ÿé™ä½åˆ° 30-60 ç§’
- **æ„å»ºæ—¶é—´**ï¼šä» 3-5 åˆ†é’Ÿé™ä½åˆ° 1-2 åˆ†é’Ÿï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰
- **æ•´ä½“æ•ˆç‡**ï¼šæå‡ 10-20%

---

## ğŸ” å…³é”®å†³ç­–è¯´æ˜

### ä¸ºä»€ä¹ˆä¸ç¼“å­˜ node_modulesï¼Ÿ
**åŸå› **ï¼š
- pnpm ä½¿ç”¨å†…å®¹å¯»å€å’Œç¬¦å·é“¾æ¥
- ç¼“å­˜ node_modules ä½“ç§¯å·¨å¤§ï¼ˆæ•°ç™¾ MBï¼‰
- å‘½ä¸­æ¦‚ç‡ä½ï¼ˆè·¯å¾„/é“¾æ¥é—®é¢˜ï¼‰
- åªç¼“å­˜ ~/.pnpm-store æ›´é«˜æ•ˆï¼ˆé€šå¸¸ < 100 MBï¼‰

### ä¸ºä»€ä¹ˆæ„å»ºç¼“å­˜ä½¿ç”¨æºç  hashï¼Ÿ
**åŸå› **ï¼š
- ä¸ä½¿ç”¨ github.shaï¼šä¼šå¯¼è‡´æ¯æ¬¡æäº¤å¿…å¤±æ•ˆ
- ä½¿ç”¨æºç  hashï¼šå¯ä»¥è·¨æäº¤å¤ç”¨
- å¤šçº§ restore-keysï¼šå³ä½¿å®Œå…¨åŒ¹é…å¤±è´¥ï¼Œä¹Ÿèƒ½éƒ¨åˆ†å¤ç”¨

### ä¸ºä»€ä¹ˆä¿æŒ Playwright è¶…æ—¶ 180sï¼Ÿ
**åŸå› **ï¼š
- 180s æ˜¯ä¿å®ˆè€Œç¨³å®šçš„é€‰æ‹©
- èƒ½è¦†ç›–å†·å¯åŠ¨å’Œ CI è¾ƒæ…¢æœºæ—¶å»¶è¿Ÿ
- ç›´æ¥é™åˆ° 120s æœ‰å¢åŠ  flaky é£é™©
- é™¤é CI æ—¥å¿—è¯æ˜ä»æœªæ…¢å¯åŠ¨ï¼Œå¦åˆ™ä¸å»ºè®®é™ä½

### ä¸ºä»€ä¹ˆè¦†ç›–ç‡é˜ˆå€¼æ— éœ€ä¿®æ”¹ï¼Ÿ
**åŸå› **ï¼š
- vitest.config.mts ä½¿ç”¨åˆ†å±‚é˜ˆå€¼ç­–ç•¥
- å…¨å±€ 65% + è·¯å¾„çº§é˜ˆå€¼ï¼ˆå¦‚ components 42%ï¼‰
- è¿™æ˜¯æ¸è¿›å¼ç­–ç•¥ï¼Œä¸ä¼šå¯¼è‡´æµ‹è¯•å¤±è´¥

### ä¸ºä»€ä¹ˆ LHCI æ— éœ€ä¿®æ”¹ï¼Ÿ
**åŸå› **ï¼š
- lighthouserc.js ä½¿ç”¨ temporary-public-storage
- ä¸éœ€è¦ LHCI_GITHUB_APP_TOKEN
- ç°æœ‰é…ç½®å·²ç»æœ‰å…œåº•æœºåˆ¶

---

## ğŸ“ å˜æ›´æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
- `.github/workflows/ci.yml`ï¼ˆ399 è¡Œï¼Œ+63 è¡Œç¼“å­˜é…ç½®ï¼Œ-3 è¡Œé‡å¤æ„å»ºï¼‰

### æ–°å¢çš„æ–‡ä»¶
- `docs/ci-optimization-pr.md`ï¼ˆPR æè¿°æ–‡æ¡£ï¼‰
- `docs/ci-optimization-summary.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## ğŸš€ åç»­ç›‘æ§

### ç›‘æ§æŒ‡æ ‡
1. **CI è¿è¡Œæ—¶é—´**ï¼šå¯¹æ¯”ä¼˜åŒ–å‰åçš„å¹³å‡æ—¶é—´
2. **ç¼“å­˜å‘½ä¸­ç‡**ï¼šç›‘æ§å„ç±»ç¼“å­˜çš„å‘½ä¸­æƒ…å†µ
3. **å¹¶å‘å–æ¶ˆæ¬¡æ•°**ï¼šç»Ÿè®¡è‡ªåŠ¨å–æ¶ˆçš„æ—§è¿è¡Œæ¬¡æ•°
4. **ä½œä¸šå¤±è´¥ç‡**ï¼šç¡®ä¿ä¼˜åŒ–ä¸å¼•å…¥æ–°çš„ flaky

### å¯é€‰ä¼˜åŒ–ï¼ˆP2ï¼‰
1. **Playwright è¶…æ—¶è°ƒæ•´**ï¼šå¦‚æœ CI æ—¥å¿—æ˜¾ç¤ºä»æœªæ…¢å¯åŠ¨ï¼Œå¯ä»¥é™ä½åˆ° 150s
2. **å·®å¼‚è¦†ç›–ç‡æ£€æŸ¥**ï¼šä»…é’ˆå¯¹å˜æ›´æ–‡ä»¶æ£€æŸ¥è¦†ç›–ç‡
3. **ç¼“å­˜é¢„çƒ­**ï¼šåœ¨ basic-checks ä¸­é¢„çƒ­æ‰€æœ‰ç¼“å­˜

---

## ğŸ™ è‡´è°¢

- **GPT-5**ï¼šæä¾›ä¸“ä¸šçš„ CI/CD å®¡è®¡å’Œåˆ†å±‚ç¼“å­˜ç­–ç•¥
- **Augment**ï¼šäº¤å‰éªŒè¯å’Œå®æ–½å»ºè®®
- **å›¢é˜Ÿ**ï¼šæŒç»­ä¼˜åŒ–å’Œæ”¹è¿› CI/CD æµç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-11-09  
**æœ€åæ›´æ–°**: 2025-11-09  
**å®æ–½çŠ¶æ€**: âœ… å·²å®Œæˆ

