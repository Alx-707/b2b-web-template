# ç¿»è¯‘æ–‡ä»¶æ¶æ„ä¸ç»´æŠ¤æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
> **æœ€åæ›´æ–°**ï¼š2025-11-08  
> **é€‚ç”¨é¡¹ç›®**ï¼šTucsenberg Web Frontier  
> **æŠ€æœ¯æ ˆ**ï¼šNext.js 15 + next-intl + React 19

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#1-æ¶æ„æ¦‚è§ˆ)
2. [ç¿»è¯‘æ–‡ä»¶æ‹†åˆ†è§„åˆ™](#2-ç¿»è¯‘æ–‡ä»¶æ‹†åˆ†è§„åˆ™)
3. [å¤–éƒ¨åŒ–åŠ è½½æœºåˆ¶](#3-å¤–éƒ¨åŒ–åŠ è½½æœºåˆ¶)
4. [ç»´æŠ¤æµç¨‹](#4-ç»´æŠ¤æµç¨‹)
5. [æ•…éšœæ’æŸ¥](#5-æ•…éšœæ’æŸ¥)
6. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#6-æ€§èƒ½ä¼˜åŒ–å»ºè®®)

---

## 1. æ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç¿»è¯‘æ–‡ä»¶æ¶æ„                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æºæ–‡ä»¶ï¼ˆå¼€å‘æ—¶ï¼‰                æ„å»ºäº§ç‰©ï¼ˆè¿è¡Œæ—¶ï¼‰
messages/                      public/messages/
â”œâ”€â”€ en/                        â”œâ”€â”€ en/
â”‚   â”œâ”€â”€ critical.json          â”‚   â”œâ”€â”€ critical.json (å‹ç¼©)
â”‚   â””â”€â”€ deferred.json          â”‚   â””â”€â”€ deferred.json (å‹ç¼©)
â””â”€â”€ zh/                        â””â”€â”€ zh/
    â”œâ”€â”€ critical.json              â”œâ”€â”€ critical.json (å‹ç¼©)
    â””â”€â”€ deferred.json              â””â”€â”€ deferred.json (å‹ç¼©)

                    â†“ prebuild è„šæœ¬

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åŠ è½½æœºåˆ¶                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ„å»ºæ—¶ï¼ˆBuild Timeï¼‰           è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰
â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿè¯»å–               â”œâ”€â”€ HTTP Fetch
â”œâ”€â”€ åŒæ­¥åŠ è½½                   â”œâ”€â”€ unstable_cache (1h)
â””â”€â”€ ç±»å‹æ¨æ–­                   â””â”€â”€ åŠ¨æ€åŠ è½½

                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡ç«¯æ¸²æŸ“                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

getRequestConfig (i18n/request.ts)
    â†“
getCachedMessages (lib/i18n-performance.ts)
    â†“
loadCriticalMessages (lib/load-messages.ts)
    â†“
NextIntlClientProvider
    â†“
useTranslations() hook
```

### 1.2 å…³é”®ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | èŒè´£ |
|------|------|------|
| **æ‹†åˆ†è„šæœ¬** | `scripts/split-translations.js` | å°†å®Œæ•´ç¿»è¯‘æ‹†åˆ†ä¸º critical/deferred |
| **æ‹·è´è„šæœ¬** | `scripts/copy-translations.js` | å‹ç¼©å¹¶æ‹·è´åˆ° public/ |
| **åŠ è½½å™¨** | `src/lib/load-messages.ts` | ç»Ÿä¸€çš„ç¿»è¯‘åŠ è½½å…¥å£ |
| **ç¼“å­˜ç®¡ç†** | `src/lib/i18n-performance.ts` | æ€§èƒ½ç›‘æ§å’Œç¼“å­˜ |
| **è¯·æ±‚é…ç½®** | `src/i18n/request.ts` | next-intl é…ç½®å…¥å£ |

---

## 2. ç¿»è¯‘æ–‡ä»¶æ‹†åˆ†è§„åˆ™

### 2.1 Critical Keysï¼ˆé¦–å±å¿…éœ€ï¼‰

**å®šä¹‰**ï¼šç”¨æˆ·é¦–æ¬¡è®¿é—®é¡µé¢æ—¶ï¼Œè§†å£å†…ï¼ˆabove-the-foldï¼‰ç«‹å³å¯è§çš„å†…å®¹æ‰€éœ€çš„ç¿»è¯‘ã€‚

**åŒ…å«å†…å®¹**ï¼š
- å¯¼èˆªæ ï¼ˆnavigationï¼‰
- Hero åŒºåŸŸï¼ˆhome.heroï¼‰
- SEO å…ƒæ•°æ®ï¼ˆseoï¼‰
- é”™è¯¯æç¤ºï¼ˆcommon.errorï¼‰
- é¦–é¡µæ‰€æœ‰å¯è§åŒºåŸŸï¼ˆhome.*ï¼‰

**é…ç½®æ–‡ä»¶**ï¼š`scripts/split-translations.js`

```javascript
const CRITICAL_KEYS = [
  'navigation',      // å¯¼èˆªæ 
  'home.hero',       // Hero åŒºåŸŸ
  'home.techStack',  // æŠ€æœ¯æ ˆå±•ç¤º
  'home.showcase',   // ç»„ä»¶å±•ç¤º
  'home.overview',   // é¡¹ç›®æ¦‚è§ˆ
  'home.cta',        // è¡ŒåŠ¨å·å¬
  'seo',             // SEO å…ƒæ•°æ®
  'common.error',    // é”™è¯¯æç¤º
  'common.loading',  // åŠ è½½æç¤º
];
```

### 2.2 Deferred Keysï¼ˆå»¶è¿ŸåŠ è½½ï¼‰

**å®šä¹‰**ï¼šé¦–å±ä¸å¯è§ï¼Œç”¨æˆ·æ»šåŠ¨æˆ–äº¤äº’åæ‰éœ€è¦çš„ç¿»è¯‘ã€‚

**åŒ…å«å†…å®¹**ï¼š
- å…¶ä»–é¡µé¢çš„ç¿»è¯‘ï¼ˆcontact, products, about, blogï¼‰
- ä¸»é¢˜æ¼”ç¤ºï¼ˆthemeDemoï¼‰
- React Scan æ¼”ç¤ºï¼ˆReactScanDemoï¼‰
- è¾…åŠ©åŠŸèƒ½æµ‹è¯•ï¼ˆaccessibilityï¼‰

### 2.3 æ‹†åˆ†è§„åˆ™

1. **é¦–å±ä¼˜å…ˆ**ï¼šå¦‚æœå†…å®¹åœ¨é¦–å±å¯è§ï¼Œå¿…é¡»æ”¾å…¥ critical
2. **è·¯ç”±éš”ç¦»**ï¼šæ¯ä¸ªè·¯ç”±çš„ç¿»è¯‘åº”è¯¥ç‹¬ç«‹ç®¡ç†
3. **å…±äº«å†…å®¹**ï¼šå¯¼èˆªã€SEOã€é”™è¯¯æç¤ºç­‰å…±äº«å†…å®¹æ”¾å…¥ critical
4. **æ€§èƒ½å¹³è¡¡**ï¼šcritical ä¸åº”è¶…è¿‡æ€»ç¿»è¯‘çš„ 70%

**å½“å‰æ‹†åˆ†æ¯”ä¾‹**ï¼š
- Critical: ~14 KB (61.5%)
- Deferred: ~9 KB (38.5%)

---

## 3. å¤–éƒ¨åŒ–åŠ è½½æœºåˆ¶

### 3.1 æ„å»ºæ—¶åŠ è½½ï¼ˆBuild Timeï¼‰

**åœºæ™¯**ï¼š`next build` æ‰§è¡Œæ—¶

**æœºåˆ¶**ï¼š
```typescript
// src/lib/load-messages.ts
const isBuildTime = process.env.NEXT_PHASE === 'phase-production-build';

if (isBuildTime) {
  // ä»æºæ–‡ä»¶è¯»å–ï¼ˆmessages/ï¼‰
  const filePath = join(process.cwd(), 'messages', locale, 'critical.json');
  const content = await readFile(filePath, 'utf-8');
  return JSON.parse(content);
}
```

**ä¼˜åŠ¿**ï¼š
- å¿«é€Ÿè®¿é—®æ–‡ä»¶ç³»ç»Ÿ
- ä¸ä¾èµ– HTTP æœåŠ¡
- æ”¯æŒç±»å‹æ¨æ–­

### 3.2 è¿è¡Œæ—¶åŠ è½½ï¼ˆRuntimeï¼‰

**åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒè¿è¡Œæ—¶

**æœºåˆ¶**ï¼š
```typescript
// è¿è¡Œæ—¶ï¼šä» public/ ç›®å½• fetch
const baseUrl = getBaseUrl();
const url = `${baseUrl}/messages/${locale}/critical.json`;
const response = await fetch(url, { next: { revalidate: 3600 } });
return await response.json();
```

**ä¼˜åŠ¿**ï¼š
- HTTP ç¼“å­˜ï¼ˆ1 å°æ—¶ï¼‰
- CDN åŠ é€Ÿ
- å¹¶è¡ŒåŠ è½½

### 3.3 ç¼“å­˜ç­–ç•¥

**ä¸‰å±‚ç¼“å­˜**ï¼š

1. **React Cache**ï¼ˆ`cache()` APIï¼‰
   - ä½œç”¨åŸŸï¼šå•æ¬¡è¯·æ±‚
   - å»é‡ç›¸åŒçš„ç¿»è¯‘åŠ è½½

2. **Next.js unstable_cache**
   - ä½œç”¨åŸŸï¼šå…¨å±€
   - æŒç»­æ—¶é—´ï¼š1 å°æ—¶ï¼ˆ3600 ç§’ï¼‰
   - è‡ªåŠ¨ revalidation

3. **TranslationCache**ï¼ˆå†…å­˜ç¼“å­˜ï¼‰
   - ä½œç”¨åŸŸï¼šè¿›ç¨‹çº§åˆ«
   - æŒç»­æ—¶é—´ï¼š1 å°æ—¶
   - æ€§èƒ½ç›‘æ§

---

## 4. ç»´æŠ¤æµç¨‹

### 4.1 æ·»åŠ æ–°ç¿»è¯‘

**æ­¥éª¤**ï¼š

1. **ç¼–è¾‘æºæ–‡ä»¶**ï¼š
   ```bash
   # ç¼–è¾‘ messages/en.json å’Œ messages/zh.json
   vim messages/en.json
   ```

2. **è¿è¡Œæ‹†åˆ†è„šæœ¬**ï¼š
   ```bash
   node scripts/split-translations.js
   ```

3. **éªŒè¯æ‹†åˆ†ç»“æœ**ï¼š
   ```bash
   # æ£€æŸ¥ critical.json å’Œ deferred.json
   ls -lh messages/en/
   ```

4. **ç±»å‹æ£€æŸ¥**ï¼š
   ```bash
   pnpm type-check
   ```

5. **æ„å»ºæµ‹è¯•**ï¼š
   ```bash
   pnpm build
   # prebuild è„šæœ¬ä¼šè‡ªåŠ¨è¿è¡Œ copy-translations.js
   ```

### 4.2 è°ƒæ•´ Critical Keys

**åœºæ™¯**ï¼šæ–°å¢é¦–å±å†…å®¹æˆ–ä¼˜åŒ–æ‹†åˆ†æ¯”ä¾‹

**æ­¥éª¤**ï¼š

1. **ç¼–è¾‘æ‹†åˆ†è„šæœ¬**ï¼š
   ```javascript
   // scripts/split-translations.js
   const CRITICAL_KEYS = [
     // ... ç°æœ‰ keys
     'newSection.title',  // æ–°å¢
   ];
   ```

2. **é‡æ–°æ‹†åˆ†**ï¼š
   ```bash
   node scripts/split-translations.js
   ```

3. **éªŒè¯å¤§å°**ï¼š
   ```bash
   # ç¡®ä¿ critical ä¸è¶…è¿‡ 70%
   du -h messages/en/critical.json messages/en/deferred.json
   ```

### 4.3 æ‰©å±•å‘½åç©ºé—´

**åœºæ™¯**ï¼šæ·»åŠ æ–°çš„ç¿»è¯‘å‘½åç©ºé—´ï¼ˆå¦‚ `products`, `services`ï¼‰

**æ­¥éª¤**ï¼š

1. **æ›´æ–°æºæ–‡ä»¶**ï¼š
   ```json
   // messages/en.json
   {
     "products": {
       "title": "Our Products",
       "description": "..."
     }
   }
   ```

2. **å†³å®šæ‹†åˆ†ä½ç½®**ï¼š
   - å¦‚æœæ˜¯é¦–å±å†…å®¹ â†’ æ·»åŠ åˆ° `CRITICAL_KEYS`
   - å¦‚æœæ˜¯å…¶ä»–é¡µé¢ â†’ è‡ªåŠ¨è¿›å…¥ deferred

3. **è¿è¡Œæ‹†åˆ†å’Œæ„å»º**ï¼š
   ```bash
   node scripts/split-translations.js
   pnpm build
   ```

---

## 5. æ•…éšœæ’æŸ¥

### 5.1 MISSING_MESSAGE é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Error: MISSING_MESSAGE: Could not resolve 'home.hero.title'
```

**åŸå› **ï¼š
1. ç¿»è¯‘é”®ä¸å­˜åœ¨äº critical.json
2. æ‹†åˆ†è„šæœ¬æœªæ­£ç¡®æ‰§è¡Œ
3. æ„å»ºç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥æºæ–‡ä»¶
cat messages/en.json | grep "home.hero.title"

# 2. é‡æ–°æ‹†åˆ†
node scripts/split-translations.js

# 3. æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°æ„å»º
rm -rf .next
pnpm build

# 4. æ£€æŸ¥ critical.json
cat messages/en/critical.json | grep "home.hero.title"
```

### 5.2 ç¼“å­˜å¤±æ•ˆé—®é¢˜

**ç—‡çŠ¶**ï¼šç¿»è¯‘æ›´æ–°åï¼Œé¡µé¢ä»æ˜¾ç¤ºæ—§å†…å®¹

**åŸå› **ï¼š
1. unstable_cache æœª revalidate
2. æµè§ˆå™¨ç¼“å­˜
3. CDN ç¼“å­˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. å¼ºåˆ¶æ¸…é™¤ Next.js ç¼“å­˜
rm -rf .next/cache

# 2. é‡å¯å¼€å‘æœåŠ¡å™¨
pnpm dev

# 3. æµè§ˆå™¨ç¡¬åˆ·æ–°
# Cmd+Shift+R (Mac) / Ctrl+Shift+R (Windows)

# 4. æ£€æŸ¥ç¼“å­˜é…ç½®
# src/lib/load-messages.ts
# revalidate: 3600 â†’ è°ƒæ•´ä¸ºæ›´çŸ­æ—¶é—´ï¼ˆå¼€å‘æ—¶ï¼‰
```

### 5.3 æ–‡ä»¶ç³»ç»Ÿå›é€€å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Error: ENOENT: no such file or directory, open 'messages/en/critical.json'
```

**åŸå› **ï¼š
1. æ‹†åˆ†è„šæœ¬æœªæ‰§è¡Œ
2. æ–‡ä»¶è·¯å¾„é”™è¯¯
3. æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la messages/en/

# 2. è¿è¡Œæ‹†åˆ†è„šæœ¬
node scripts/split-translations.js

# 3. æ£€æŸ¥æƒé™
chmod 644 messages/en/*.json

# 4. éªŒè¯è·¯å¾„
pwd  # ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
```

---

## 6. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 6.1 å½“å‰æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **First Load JS** | 227 KB | ä¸åŒ…å«ç¿»è¯‘æ•°æ® |
| **Critical ç¿»è¯‘** | 14 KB | é€šè¿‡ HTTP åŠ è½½ |
| **Deferred ç¿»è¯‘** | 9 KB | æŒ‰éœ€åŠ è½½ |
| **ç¼“å­˜å‘½ä¸­ç‡** | ~85% | 1 å°æ—¶ revalidation |

### 6.2 è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

**A. Vendors Chunk ä¼˜åŒ–ï¼ˆ123 KBï¼‰**
```bash
# åˆ†æ vendors chunk
ANALYZE=true pnpm build

# ä¼˜åŒ–æ–¹å‘ï¼š
# 1. Tree-shaking Radix UI ç»„ä»¶
# 2. æŒ‰éœ€å¯¼å…¥ next-intl åŠŸèƒ½
# 3. ä»£ç åˆ†å‰²ç¬¬ä¸‰æ–¹åº“
```

**B. ç¿»è¯‘æ–‡ä»¶å‹ç¼©**
```bash
# å½“å‰ï¼šJSON å‹ç¼©ï¼ˆç§»é™¤ç©ºæ ¼ï¼‰
# è¿›ä¸€æ­¥ï¼šè€ƒè™‘ Brotli å‹ç¼©

# é¢„æœŸæ”¶ç›Šï¼š-20% æ–‡ä»¶å¤§å°
```

**C. é¢„åŠ è½½ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ <link rel="prefetch"> é¢„åŠ è½½ç¿»è¯‘
<link rel="prefetch" href="/messages/en/deferred.json" />
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¿»è¯‘ä¼˜åŒ–å†ç¨‹](./i18n-optimization-journey.md) - å®Œæ•´çš„ä¼˜åŒ–è¿‡ç¨‹è®°å½•
- [P0 + P1 å®æ–½è®¡åˆ’](./p0-p1-implementation-plan.md) - è¯¦ç»†çš„å®æ–½æ­¥éª¤
- [å®šåˆ¶æŒ‡å—](./customization-guide.md) - ç¿»è¯‘å®šåˆ¶è¯´æ˜

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0 (2025-11-08)
- åˆå§‹ç‰ˆæœ¬
- è®°å½•ç¿»è¯‘æ¶æ„å’Œç»´æŠ¤æµç¨‹
- æ·»åŠ æ•…éšœæ’æŸ¥æŒ‡å—
- è¡¥å……æ€§èƒ½ä¼˜åŒ–å»ºè®®

